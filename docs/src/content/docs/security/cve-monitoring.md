---
title: CVE Monitoring
description: How CVE scanning, OPA policy enforcement, and quarantine work in Trusted Base Images.
---

Every Trusted Base Image is scanned for vulnerabilities during the build phase, and the results are evaluated against security policies during the review phase.

## Scanning Pipeline

1. **Build phase**: Grype scans the built image and produces `cve-report.json`
2. **Review phase**: OPA evaluates the scan results against the security threshold policy
3. **Release phase**: Images that pass are promoted to `trusted`; images that fail are sent to `quarantine`

## Grype Scanning

[Grype](https://github.com/anchore/grype) scans the image against known vulnerability databases:

```bash
grype <image> -o json > cve-report.json
```

The scan results include:
- CVE identifier
- Affected package and version
- Severity (Critical, High, Medium, Low)
- Fixed version (if available)

## OPA Policy

The security threshold is enforced by an [Open Policy Agent](https://www.openpolicyagent.org/) (OPA) policy at `.github/pdp/policies.rego`:

```rego
violation_security_threshold[msg] if {
    input.scan_results.critical_count > 0
    msg := "Critical vulnerabilities found. Deployment denied."
}

violation_security_threshold[msg] if {
    input.scan_results.high_count > 0
    msg := "High vulnerabilities found. Deployment denied."
}
```

### Current Thresholds

| Severity | Threshold | Action |
|----------|:---------:|--------|
| Critical | > 0 | **Block** — image quarantined |
| High | > 0 | **Block** — image quarantined |
| Medium | Any | Allow |
| Low | Any | Allow |

## Quarantine

When an image fails the CVE policy:

1. The review verdict is set to `FAIL`
2. The Release-Actor promotes the image to the `quarantine` namespace instead of `trusted`
3. The image is tagged as `pr-<number>-<arch>` in quarantine
4. No manifest list is created for quarantined images
5. The release summary comment on the PR indicates which images were quarantined

Quarantined images can be investigated and, after the underlying CVEs are addressed, a new build can be triggered.

## CVE Data in Inventory

The [inventory pages](/trusted-base-oci-images/inventory/) display current CVE data for each image, grouped by severity. This data is automatically updated after each release by the `doc-release.yml` workflow.

## Monitoring Upstream CVEs

CVE databases are continuously updated. An image that passes today may have new vulnerabilities discovered tomorrow. The current approach requires manual re-scanning by triggering a new build. See the [Roadmap](/trusted-base-oci-images/reference/roadmap/) for planned automatic CVE announcement triggers.
